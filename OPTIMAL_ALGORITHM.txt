╔═══════════════════════════════════════════════════════════════════════════╗
║                    OPTIMAL STINT CALCULATOR ALGORITHM                      ║
╚═══════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────┐
│ INPUT DATA                                                               │
├─────────────────────────────────────────────────────────────────────────┤
│ • Stint History (all completed stints)                                   │
│ • Target Stint Time (e.g., 30 min)                                       │
│ • Max Stint Time (e.g., 45 min)                                          │
│ • Total Race Time (e.g., 6 hours)                                        │
│ • Elapsed Race Time                                                      │
│ • Driver Changes Used                                                    │
│ • Max Driver Changes (e.g., 12)                                          │
└─────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────┐
│ STEP 1: PERFORMANCE ANALYSIS                                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  Average Stint Time = Σ(stint durations) / count                         │
│  ┌─────────────────────────────────────────────────────────┐            │
│  │ Example: (32 + 31 + 28 + 33 + 35) / 5 = 31.8 min        │            │
│  └─────────────────────────────────────────────────────────┘            │
│                                                                           │
│  Standard Deviation = √(variance of stints)                              │
│  ┌─────────────────────────────────────────────────────────┐            │
│  │ Measures how "jumpy" your stint times are                │            │
│  └─────────────────────────────────────────────────────────┘            │
│                                                                           │
│  Consistency Score = 100 - (std_dev / average × 100)                     │
│  ┌─────────────────────────────────────────────────────────┐            │
│  │ 100% = Perfect, 70%+ = Good, <70% = Variable            │            │
│  └─────────────────────────────────────────────────────────┘            │
│                                                                           │
│  Recent Average (if consistent) = Avg of last 3 stints                   │
│  ┌─────────────────────────────────────────────────────────┐            │
│  │ Weights recent performance more heavily                  │            │
│  └─────────────────────────────────────────────────────────┘            │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────┐
│ STEP 2: RACE REQUIREMENTS CALCULATION                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  Remaining Race Time = Total - Elapsed                                   │
│  ┌─────────────────────────────────────────────────────────┐            │
│  │ Example: 360 min - 160 min = 200 min remaining          │            │
│  └─────────────────────────────────────────────────────────┘            │
│                                                                           │
│  Stints Remaining = (Max Changes - Used Changes) + 1                     │
│  ┌─────────────────────────────────────────────────────────┐            │
│  │ Example: (12 - 5) + 1 = 8 stints left                   │            │
│  │ (+1 includes current/final stint)                        │            │
│  └─────────────────────────────────────────────────────────┘            │
│                                                                           │
│  Time Needed Per Stint = Remaining Time / Stints Remaining               │
│  ┌─────────────────────────────────────────────────────────┐            │
│  │ Example: 200 min / 8 = 25 min per stint needed          │            │
│  └─────────────────────────────────────────────────────────┘            │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────┐
│ STEP 3: DECISION TREE                                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  Is this the final stint?                                                │
│  ├─ YES ──→ Optimal = Remaining Time                                     │
│  │          Confidence = 100%                                            │
│  │          "Final stint - run to the end"                               │
│  │                                                                        │
│  └─ NO ──→ Is Time Needed > Max Stint Time?                              │
│            ├─ YES ──→ Optimal = Max Stint Time                           │
│            │          Confidence = 90%                                   │
│            │          "Run maximum stint times"                          │
│            │                                                              │
│            └─ NO ──→ Is Time Needed < Target × 0.8?                      │
│                      ├─ YES ──→ Optimal = max(Target×0.85, Time Needed)  │
│                      │          Confidence = 85%                         │
│                      │          "Race pace good - maintain consistency"   │
│                      │                                                    │
│                      └─ NO ──→ BALANCED CALCULATION ↓                    │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────┐
│ STEP 4: BALANCED CALCULATION (Most Common Case)                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  Performance Base = {                                                    │
│    if Consistency > 70%: Recent Average (last 3 stints)                  │
│    else: Overall Average                                                 │
│  }                                                                        │
│                                                                           │
│  ┌──────────────────────────────────────────────────────┐               │
│  │ WEIGHTED FORMULA:                                     │               │
│  │                                                        │               │
│  │ Optimal Time = (Performance Base × 60%)               │               │
│  │              + (Time Needed × 40%)                     │               │
│  │                                                        │               │
│  │ Example:                                               │               │
│  │   Performance = 31 min                                │               │
│  │   Time Needed = 28 min                                │               │
│  │   Optimal = (31 × 0.6) + (28 × 0.4)                  │               │
│  │          = 18.6 + 11.2 = 29.8 min                    │               │
│  └──────────────────────────────────────────────────────┘               │
│                                                                           │
│  Clamp to reasonable bounds:                                             │
│  ├─ Minimum: Target × 0.9 (e.g., 27 min if target is 30)                │
│  └─ Maximum: Max × 0.95 (e.g., 42.75 min if max is 45)                  │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────┐
│ STEP 5: GENERATE RECOMMENDATION                                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  Compare Optimal vs Average:                                             │
│                                                                           │
│  if Optimal > Average × 1.1:                                             │
│    ──→ "Extend stint length to meet race duration"                       │
│       Confidence = 75%                                                   │
│                                                                           │
│  else if Optimal < Average × 0.9:                                        │
│    ──→ "Can run shorter stints - focus on consistency"                   │
│       Confidence = 80%                                                   │
│                                                                           │
│  else:                                                                   │
│    ──→ "Maintain current pace - on track"                                │
│       Confidence = 85%                                                   │
│                                                                           │
│  Additional Warnings:                                                    │
│  if Over-Max Count > Total × 30%:                                        │
│    ──→ Add "⚠ (Watch for over-max stints)"                               │
│       Reduce confidence by 15%                                           │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────┐
│ OUTPUT                                                                   │
├─────────────────────────────────────────────────────────────────────────┤
│ • Optimal Stint Time (in minutes:seconds)                                │
│ • Confidence Score (50-100%)                                             │
│ • Strategic Recommendation                                               │
│ • Performance Analytics:                                                 │
│   ├─ Average Stint Time                                                  │
│   ├─ Consistency Score                                                   │
│   ├─ Stints at Target                                                    │
│   ├─ Stints Over Max                                                     │
│   ├─ Time Per Remaining Stint                                            │
│   └─ Stints Remaining                                                    │
└─────────────────────────────────────────────────────────────────────────┘

╔═══════════════════════════════════════════════════════════════════════════╗
║                             KEY PRINCIPLES                                 ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                                                            ║
║  1. LEARN FROM HISTORY: Use actual performance data, not just targets     ║
║  2. BALANCE NEEDS: Weight both performance (60%) and requirements (40%)   ║
║  3. REWARD CONSISTENCY: Trust recent data more when performance is stable ║
║  4. SAFETY MARGINS: Clamp to safe bounds, never suggest impossible stints ║
║  5. CLEAR COMMUNICATION: Simple recommendations with confidence levels    ║
║  6. ADAPT CONTINUOUSLY: Recalculates every second with latest data        ║
║                                                                            ║
╚═══════════════════════════════════════════════════════════════════════════╝

COMPLEXITY SCALING:
━━━━━━━━━━━━━━━━━
0 stints:    Target time, 0% confidence
1-2 stints:  Basic averaging, 60-70% confidence
3-5 stints:  Pattern recognition, 75-85% confidence
6+ stints:   High accuracy, 80-90% confidence
Final stint: Exact calculation, 100% confidence
